var s=(s,e,a)=>new Promise(((n,i)=>{var t=s=>{try{l(a.next(s))}catch(e){i(e)}},r=s=>{try{l(a.throw(s))}catch(e){i(e)}},l=s=>s.done?n(s.value):Promise.resolve(s.value).then(t,r);l((a=a.apply(s,e)).next())}));import{j as e}from"./vendor-bootstrap-CDKGkX3Y.js";import{r as a}from"./vendor-react-CSr-5IoM.js";import{a2 as n,a3 as i,a4 as t,a5 as r,a6 as l,a7 as c}from"./index-B4iOs_t-.js";import{u as o}from"./vendor-router-D9z9DFGH.js";import"./vendor-redux-DhM9Zidd.js";import"./vendor-query-BOtKDBw2.js";import"./vendor-ui-rAPUFMbG.js";const d=({phoneNumber:s="+16479686445",message:a="Hello! I need help with my subscription",position:i="bottom-right",showText:t=!0,className:r=""})=>e.jsxs("button",{className:`whatsapp-support-button ${(()=>{switch(i){case"bottom-left":return"whatsapp-btn-bottom-left";case"top-right":return"whatsapp-btn-top-right";case"top-left":return"whatsapp-btn-top-left";default:return"whatsapp-btn-bottom-right"}})()} ${r}`,onClick:()=>{const e=`https://wa.me/${s.replace(/\D/g,"")}?text=${encodeURIComponent(a)}`;window.open(e,"_blank","noopener,noreferrer")},"aria-label":"Contact us on WhatsApp",title:"Chat with support on WhatsApp",children:[e.jsx(n,{className:"whatsapp-icon",size:24}),t&&e.jsx("span",{className:"whatsapp-text",children:"Need Help?"})]}),p=()=>{const[n,p]=a.useState([]),[u,h]=a.useState(!0),[m,x]=a.useState(!0),[b,j]=a.useState(null),[g,v]=a.useState(!1),[N,f]=a.useState(null),[w,_]=a.useState("en");o(),a.useEffect((()=>{y()}),[]),a.useEffect((()=>{m||S()}),[w,m]);const y=()=>s(void 0,null,(function*(){var s,e;try{x(!0);const s=yield i.getPendingSubscription();if(s.has_pending&&s.pending_subscription)return void(window.location.href="/subscription/pending")}catch(a){404===(null==(s=a.response)?void 0:s.status)||null==(e=a.response)||e.status}finally{x(!1)}})),S=()=>s(void 0,null,(function*(){try{h(!0),f(null);const s=yield i.getPlans(w);p(s)}catch(s){f("Failed to load subscription plans. Please try again.")}finally{h(!1)}})),k=s=>s.is_featured?e.jsx(r,{className:"plan-badge-icon"}):s.is_popular?e.jsx(l,{className:"plan-badge-icon"}):s.is_trial?e.jsx(c,{className:"plan-badge-icon"}):null,C=s=>{const a=i.getPlanBadge(s);return a?e.jsxs("div",{className:"plan-badge "+(s.is_featured?"featured":s.is_popular?"popular":"trial"),children:[k(s),e.jsx("span",{children:a})]}):null};return m?e.jsx("div",{className:"subscription-container",children:e.jsxs("div",{className:"subscription-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Checking subscription status..."})]})}):u?e.jsx("div",{className:"subscription-container",children:e.jsxs("div",{className:"subscription-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading subscription plans..."})]})}):e.jsxs("div",{className:"subscription-container",children:[e.jsxs("div",{className:"subscription-hero",children:[e.jsx("h1",{className:"subscription-title",children:"Choose Your Subscription Plan"}),e.jsx("p",{className:"subscription-subtitle",children:"Unlimited movies, HD streaming, and ad-free experience"}),e.jsxs("div",{className:"language-selector",children:[e.jsx("button",{className:"en"===w?"active":"",onClick:()=>_("en"),children:"English"}),e.jsx("button",{className:"lg"===w?"active":"",onClick:()=>_("lg"),children:"Luganda"}),e.jsx("button",{className:"sw"===w?"active":"",onClick:()=>_("sw"),children:"Swahili"})]})]}),N&&e.jsxs("div",{className:"error-message",children:[e.jsx("p",{children:N}),e.jsx("button",{onClick:()=>f(null),children:"Dismiss"})]}),e.jsx("div",{className:"plans-grid",children:n.map((a=>e.jsxs("div",{className:`plan-card ${a.is_featured?"featured":""} ${b===a.id?"selected":""}`,children:[C(a),e.jsxs("div",{className:"plan-header",children:[e.jsx("h3",{className:"plan-name",children:a.name}),e.jsx("p",{className:"plan-description",children:a.description})]}),e.jsxs("div",{className:"plan-pricing",children:[a.discount_percentage>0&&e.jsxs("div",{className:"plan-original-price",children:[a.currency," ",Math.round(a.price).toLocaleString()]}),e.jsxs("div",{className:"plan-price",children:[e.jsx("span",{className:"currency",children:a.currency}),e.jsx("span",{className:"amount",children:Math.round(a.actual_price).toLocaleString()})]}),e.jsx("div",{className:"plan-duration",children:a.duration_text}),e.jsxs("div",{className:"plan-daily-cost",children:[a.currency," ",Math.round(a.daily_cost)," per day"]})]}),e.jsx("div",{className:"plan-features",children:a.features_array.map(((s,a)=>e.jsxs("div",{className:"plan-feature",children:[e.jsx(t,{className:"feature-check"}),e.jsx("span",{dangerouslySetInnerHTML:{__html:s}})]},a)))}),e.jsx("button",{className:"subscribe-btn",onClick:()=>{return e=a.id,s(void 0,null,(function*(){var s,a;try{v(!0),j(e),f(null);const s=yield i.getPendingSubscription();if(s.has_pending&&s.pending_subscription)return void(window.location.href="/subscription/pending");const a=yield i.createSubscription({plan_id:e,callback_url:`${window.location.origin}/subscription/callback`});localStorage.setItem("pending_subscription_check",JSON.stringify({subscription_id:a.subscription_id,order_tracking_id:a.order_tracking_id,started_at:(new Date).toISOString()})),window.open(a.redirect_url,"_blank"),window.location.href="/subscription/pending"}catch(n){f((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.message)||"Failed to create subscription. Please try again."),v(!1),j(null)}}));var e},disabled:g,children:g&&b===a.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Processing..."})]}):e.jsx("span",{children:"Subscribe Now"})})]},a.id)))}),e.jsxs("div",{className:"whatsapp-container",children:[e.jsx("p",{children:"Need help? Contact us on WhatsApp"}),e.jsx(d,{})]})]})};export{p as default};

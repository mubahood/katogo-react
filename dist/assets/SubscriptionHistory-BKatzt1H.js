var s=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(e,a,t)=>a in e?s(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,l=(s,e)=>{for(var a in e||(e={}))i.call(e,a)&&r(s,a,e[a]);if(t)for(var a of t(e))n.call(e,a)&&r(s,a,e[a]);return s},c=(s,t)=>e(s,a(t)),d=(s,e,a)=>new Promise(((t,i)=>{var n=s=>{try{l(a.next(s))}catch(e){i(e)}},r=s=>{try{l(a.throw(s))}catch(e){i(e)}},l=s=>s.done?t(s.value):Promise.resolve(s.value).then(n,r);l((a=a.apply(s,e)).next())}));import{j as o}from"./vendor-bootstrap-CDKGkX3Y.js";import{r as m}from"./vendor-react-CSr-5IoM.js";import{a3 as u,ah as h,ad as p,aa as j,ab as x}from"./index-BzUMVULD.js";import{u as y}from"./vendor-router-D9z9DFGH.js";import"./vendor-redux-DhM9Zidd.js";import"./vendor-query-BOtKDBw2.js";import"./vendor-ui-C66qigmO.js";const b=()=>{var s,e;const[a,t]=m.useState(null),[i,n]=m.useState(!0),[r,b]=m.useState(null),[v,N]=m.useState({}),f=y();m.useEffect((()=>{g()}),[]);const g=()=>d(void 0,null,(function*(){try{n(!0),b(null);const s=yield u.getHistory();t(s)}catch(s){b("Failed to load subscription history")}finally{n(!1)}})),_=s=>{switch(s){case"Active":return o.jsx(p,{className:"status-icon active"});case"Expired":return o.jsx(x,{className:"status-icon expired"});case"Cancelled":return o.jsx(x,{className:"status-icon cancelled"});case"Pending":return o.jsx(j,{className:"status-icon pending"});default:return o.jsx(j,{className:"status-icon"})}},P=s=>s.toLowerCase(),S=()=>{f("/subscription/plans")};return i?o.jsx("div",{className:"history-container",children:o.jsxs("div",{className:"history-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading history..."})]})}):r?o.jsx("div",{className:"history-container",children:o.jsxs("div",{className:"history-error",children:[o.jsx("p",{children:r}),o.jsx("button",{onClick:g,className:"retry-btn",children:"Retry"})]})}):a?o.jsxs("div",{className:"history-container",children:[o.jsxs("div",{className:"history-header",children:[o.jsxs("button",{className:"back-btn",onClick:()=>{f("/dashboard")},children:[o.jsx(h,{}),o.jsx("span",{children:"Back to Dashboard"})]}),o.jsx("h1",{className:"history-title",children:"Subscription History"}),o.jsx("p",{className:"history-subtitle",children:"View your past subscriptions and payments"})]}),o.jsxs("div",{className:"history-summary",children:[o.jsxs("div",{className:"summary-stat",children:[o.jsx("span",{className:"summary-label",children:"Total Subscriptions"}),o.jsx("span",{className:"summary-value",children:(null==(s=a.subscriptions)?void 0:s.length)||0})]}),o.jsxs("div",{className:"summary-stat",children:[o.jsx("span",{className:"summary-label",children:"Total Spent"}),o.jsxs("span",{className:"summary-value",children:[a.currency||"UGX"," ",Math.round(a.total_spent||0).toLocaleString()]})]})]}),a.subscriptions&&0!==a.subscriptions.length?o.jsx("div",{className:"history-list",children:null==(e=a.subscriptions)?void 0:e.map((s=>{return o.jsxs("div",{className:`history-item ${P(s.status)}`,children:[o.jsxs("div",{className:"history-item-header",children:[o.jsxs("div",{className:"history-item-title",children:[o.jsx("h3",{children:s.plan.name}),o.jsxs("div",{className:"history-item-badges",children:[o.jsxs("span",{className:`status-badge ${P(s.status)}`,children:[_(s.status),o.jsx("span",{children:s.status})]}),o.jsx("span",{className:`payment-badge ${e=s.payment_status,e.toLowerCase()}`,children:s.payment_status})]})]}),o.jsxs("div",{className:"history-item-amount",children:[o.jsx("span",{className:"amount-label",children:"Amount Paid"}),o.jsxs("span",{className:"amount-value",children:[s.plan.currency," ",Math.round(s.plan.actual_price).toLocaleString()]})]})]}),o.jsxs("div",{className:"history-item-details",children:[o.jsxs("div",{className:"detail-grid",children:[o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Duration"}),o.jsx("span",{className:"detail-value",children:s.plan.duration_text})]}),o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Payment Method"}),o.jsx("span",{className:"detail-value",children:s.payment_method||"Pesapal"})]}),o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"Start Date"}),o.jsx("span",{className:"detail-value",children:u.formatDate(s.start_date_time)})]}),o.jsxs("div",{className:"detail-item",children:[o.jsx("span",{className:"detail-label",children:"End Date"}),o.jsx("span",{className:"detail-value",children:u.formatDate(s.end_date_time)})]})]}),s.merchant_reference&&o.jsxs("div",{className:"reference-info",children:[o.jsx("span",{className:"reference-label",children:"Reference:"}),o.jsx("span",{className:"reference-value",children:s.merchant_reference})]}),s.is_extension&&o.jsx("div",{className:"extension-badge",children:"Extended from previous subscription"}),s.cancelled_at&&o.jsxs("div",{className:"cancelled-info",children:[o.jsxs("p",{children:["Cancelled on ",u.formatDate(s.cancelled_at)]}),s.cancelled_reason&&o.jsxs("p",{children:["Reason: ",s.cancelled_reason]})]}),"Pending"===s.status&&"Pending"===s.payment_status&&o.jsx("div",{className:"subscription-actions",children:o.jsx("button",{className:"check-status-btn",onClick:()=>{return e=s.id,d(void 0,null,(function*(){try{N((s=>c(l({},s),{[e]:!0})));const s=yield u.checkPaymentStatus({subscription_id:e});if(a&&a.subscriptions){const i=a.subscriptions.map((a=>a.id===e?s:a));t(c(l({},a),{subscriptions:i}))}alert(`Payment status checked successfully. Status: ${s.status}, Payment: ${s.payment_status}`)}catch(s){alert("Failed to check payment status. Please try again.")}finally{N((s=>c(l({},s),{[e]:!1})))}}));var e},disabled:v[s.id],children:v[s.id]?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"spinner-small"}),o.jsx("span",{children:"Checking..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(p,{}),o.jsx("span",{children:"Check Payment Status"})]})})})]})]},s.id);var e}))}):o.jsxs("div",{className:"history-empty",children:[o.jsx("p",{children:"You haven't subscribed yet"}),o.jsx("button",{className:"subscribe-btn",onClick:S,children:"Subscribe Now"})]}),a.subscriptions&&a.subscriptions.length>0&&o.jsx("div",{className:"history-footer",children:o.jsx("button",{className:"subscribe-again-btn",onClick:S,children:"Subscribe Again"})})]}):null};export{b as default};

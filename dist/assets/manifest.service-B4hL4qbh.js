var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i),s=(e,t,s)=>new Promise(((i,n)=>{var r=e=>{try{o(s.next(e))}catch(t){n(t)}},a=e=>{try{o(s.throw(e))}catch(t){n(t)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,a);o((s=s.apply(e,t)).next())}));import{A as i}from"./api.config-D25WIGfW.js";import{h as n,U as r,X as a,Y as o}from"./index-C_CdsbTE.js";import"./vendor-bootstrap-CDKGkX3Y.js";import"./vendor-react-CSr-5IoM.js";import"./vendor-redux-DhM9Zidd.js";import"./vendor-router-D9z9DFGH.js";import"./vendor-query-BOtKDBw2.js";import"./vendor-ui-rAPUFMbG.js";const u=new class{constructor(){t(this,"baseUrl",i.BASE_URL),t(this,"lastRequestTime",0),t(this,"isRequesting",!1),t(this,"pendingRequest",null),t(this,"cachedResponse",null),t(this,"MIN_REQUEST_INTERVAL",3e3),t(this,"RATE_LIMIT_BACKOFF",3e4),t(this,"CACHE_DURATION",6e4)}getManifest(){return s(this,null,(function*(){const e=Date.now();if(this.cachedResponse&&e-this.lastRequestTime<this.CACHE_DURATION)return this.cachedResponse;if(this.pendingRequest)return this.pendingRequest;if(e-this.lastRequestTime<this.MIN_REQUEST_INTERVAL&&this.cachedResponse)return this.cachedResponse;this.pendingRequest=this.executeManifestRequest(),this.lastRequestTime=e;try{const e=yield this.pendingRequest;return this.cachedResponse=e,e}finally{this.pendingRequest=null}}))}executeManifestRequest(){return s(this,null,(function*(){var e;try{const e=yield n("manifest",{});if(1!==e.code)throw new Error(e.message||"Failed to load manifest");return e}catch(t){return(null==(e=t.message)?void 0:e.includes("Rate limited"))&&this.cachedResponse?this.cachedResponse:{code:0,message:t.message||"Failed to load content",data:{top_movie:[],lists:[],genres:[],vj:[],platform_type:"",APP_VERSION:18,UPDATE_NOTES:"",WHATSAPP_CONTAT_NUMBER:""}}}}))}clearCache(){this.cachedResponse=null,this.lastRequestTime=0,this.pendingRequest=null}getMoviesByCategory(e,t=1,i=20){return s(this,null,(function*(){try{const s=yield n("movies",{category:e,page:t.toString(),limit:i.toString()});return 1===s.code&&s.data?s.data:[]}catch(s){return[]}}))}searchMovies(e,t=1){return s(this,null,(function*(){try{const s=yield n("movies",{search:e,page:t.toString()});return 1===s.code&&s.data?s.data:[]}catch(s){return[]}}))}getCurrentUser(){return r.loadFromDatabase(a)}isAuthenticated(){const e=r.loadFromDatabase(o),t=r.loadFromDatabase(a);return!(!e||!t)}};export{u as default,u as manifestService};

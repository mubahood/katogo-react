var s=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,c=(e,a,t)=>a in e?s(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,l=(s,e)=>{for(var a in e||(e={}))i.call(e,a)&&c(s,a,e[a]);if(t)for(var a of t(e))n.call(e,a)&&c(s,a,e[a]);return s},r=(s,t)=>e(s,a(t)),d=(s,e,a)=>new Promise(((t,i)=>{var n=s=>{try{l(a.next(s))}catch(e){i(e)}},c=s=>{try{l(a.throw(s))}catch(e){i(e)}},l=s=>s.done?t(s.value):Promise.resolve(s.value).then(n,c);l((a=a.apply(s,e)).next())}));import{j as o}from"./vendor-bootstrap-CDKGkX3Y.js";import{r as u}from"./vendor-react-CSr-5IoM.js";import{a3 as m,a9 as p,ai as h,a5 as x,ad as j,aa as v,aj as N,ab as b}from"./index-BzUMVULD.js";import{u as y}from"./vendor-router-D9z9DFGH.js";import"./vendor-redux-DhM9Zidd.js";import"./vendor-query-BOtKDBw2.js";import"./vendor-ui-C66qigmO.js";const f=()=>{const[s,e]=u.useState([]),[a,t]=u.useState([]),[i,n]=u.useState(!0),[c,f]=u.useState(null),[g,P]=u.useState({}),[_,w]=u.useState("all"),[k,S]=u.useState(0),[C,A]=u.useState("UGX"),O=y();u.useEffect((()=>{E()}),[]),u.useEffect((()=>{F()}),[_,s]);const E=()=>d(void 0,null,(function*(){try{n(!0),f(null);const s=yield m.getHistory(50);e(s.subscriptions||[]),S(s.total_spent||0),A(s.currency||"UGX")}catch(s){f("Failed to load subscriptions")}finally{n(!1)}})),F=()=>{let e=s;switch(_){case"active":e=s.filter((s=>s.is_active||"Active"===s.status));break;case"pending":e=s.filter((s=>"Pending"===s.status));break;case"expired":e=s.filter((s=>s.is_expired||"Expired"===s.status));break;default:e=s}t(e)},D=s=>{switch(s){case"Active":return o.jsx(j,{className:"status-icon active"});case"Expired":return o.jsx(b,{className:"status-icon expired"});case"Cancelled":return o.jsx(b,{className:"status-icon cancelled"});case"Pending":return o.jsx(v,{className:"status-icon pending"});case"Failed":return o.jsx(p,{className:"status-icon failed"});default:return o.jsx(v,{className:"status-icon"})}},$=s=>s.toLowerCase(),L={all:s.length,active:s.filter((s=>s.is_active||"Active"===s.status)).length,pending:s.filter((s=>"Pending"===s.status)).length,expired:s.filter((s=>s.is_expired||"Expired"===s.status)).length};return i?o.jsx("div",{className:"my-subscriptions-container",children:o.jsxs("div",{className:"loading-state",children:[o.jsx("div",{className:"spinner-large"}),o.jsx("p",{children:"Loading your subscriptions..."})]})}):c?o.jsx("div",{className:"my-subscriptions-container",children:o.jsxs("div",{className:"error-state",children:[o.jsx(p,{className:"error-icon"}),o.jsx("p",{children:c}),o.jsxs("button",{onClick:E,className:"retry-btn",children:[o.jsx(h,{})," Retry"]})]})}):o.jsxs("div",{className:"my-subscriptions-container",children:[o.jsx("div",{className:"subscriptions-header",children:o.jsxs("div",{className:"header-content",children:[o.jsxs("div",{className:"header-text",children:[o.jsxs("h1",{className:"page-title",children:[o.jsx(x,{})," My Subscriptions"]}),o.jsx("p",{className:"page-subtitle",children:"Manage all your subscriptions and check payment status"})]}),o.jsx("button",{className:"new-subscription-btn",onClick:()=>O("/subscription/plans"),children:"+ New Subscription"})]})}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-card total",children:[o.jsx("div",{className:"stat-icon",children:o.jsx(x,{})}),o.jsxs("div",{className:"stat-info",children:[o.jsx("p",{className:"stat-label",children:"Total Subscriptions"}),o.jsx("p",{className:"stat-value",children:s.length})]})]}),o.jsxs("div",{className:"stat-card active",children:[o.jsx("div",{className:"stat-icon",children:o.jsx(j,{})}),o.jsxs("div",{className:"stat-info",children:[o.jsx("p",{className:"stat-label",children:"Active"}),o.jsx("p",{className:"stat-value",children:L.active})]})]}),o.jsxs("div",{className:"stat-card pending",children:[o.jsx("div",{className:"stat-icon",children:o.jsx(v,{})}),o.jsxs("div",{className:"stat-info",children:[o.jsx("p",{className:"stat-label",children:"Pending"}),o.jsx("p",{className:"stat-value",children:L.pending})]})]}),o.jsxs("div",{className:"stat-card spent",children:[o.jsx("div",{className:"stat-icon",children:o.jsx(N,{})}),o.jsxs("div",{className:"stat-info",children:[o.jsx("p",{className:"stat-label",children:"Total Spent"}),o.jsxs("p",{className:"stat-value",children:[C," ",Math.round(k).toLocaleString()]})]})]})]}),o.jsxs("div",{className:"filters-bar",children:[o.jsxs("button",{className:"filter-btn "+("all"===_?"active":""),onClick:()=>w("all"),children:["All (",L.all,")"]}),o.jsxs("button",{className:"filter-btn "+("active"===_?"active":""),onClick:()=>w("active"),children:["Active (",L.active,")"]}),o.jsxs("button",{className:"filter-btn "+("pending"===_?"active":""),onClick:()=>w("pending"),children:["Pending (",L.pending,")"]}),o.jsxs("button",{className:"filter-btn "+("expired"===_?"active":""),onClick:()=>w("expired"),children:["Expired (",L.expired,")"]})]}),0===a.length?o.jsxs("div",{className:"empty-state",children:[o.jsx(x,{className:"empty-icon"}),o.jsx("h3",{children:"No subscriptions found"}),o.jsx("p",{children:"all"===_?"You haven't subscribed yet. Start enjoying premium content!":`No ${_} subscriptions found.`}),o.jsx("button",{className:"subscribe-btn",onClick:()=>O("/subscription/plans"),children:"View Subscription Plans"})]}):o.jsx("div",{className:"subscriptions-grid",children:a.map((a=>{var t,i;return o.jsxs("div",{className:`subscription-card ${$(a.status)}`,children:[o.jsxs("div",{className:"card-header",children:[o.jsxs("div",{className:"plan-info",children:[o.jsx("h3",{className:"plan-name",children:(null==(t=a.plan)?void 0:t.name)||"Unknown Plan"}),o.jsx("p",{className:"plan-duration",children:(null==(i=a.plan)?void 0:i.duration_text)||""})]}),o.jsx("div",{className:"status-badges",children:o.jsxs("span",{className:`status-badge ${$(a.status)}`,children:[D(a.status),o.jsx("span",{children:a.status})]})})]}),o.jsxs("div",{className:"card-body",children:[o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Amount Paid:"}),o.jsxs("span",{className:"info-value price",children:[a.currency," ",Math.round(a.amount_paid).toLocaleString()]})]}),o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Payment Status:"}),o.jsx("span",{className:`payment-status ${a.payment_status.toLowerCase()}`,children:a.payment_status})]}),o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"Start Date:"}),o.jsx("span",{className:"info-value",children:m.formatDate(a.start_date)})]}),o.jsxs("div",{className:"info-row",children:[o.jsx("span",{className:"info-label",children:"End Date:"}),o.jsx("span",{className:"info-value",children:m.formatDate(a.end_date)})]}),a.is_active&&o.jsxs("div",{className:"info-row highlight",children:[o.jsx("span",{className:"info-label",children:"Days Remaining:"}),o.jsxs("span",{className:"info-value days",children:[a.days_remaining," ",1===a.days_remaining?"day":"days"]})]}),a.is_in_grace_period&&o.jsxs("div",{className:"grace-period-notice",children:[o.jsx(p,{})," Grace Period Active"]})]}),"Pending"===a.status&&o.jsxs("div",{className:"card-actions",children:[o.jsx("button",{className:"action-btn check-status",onClick:()=>{return t=a.id,d(void 0,null,(function*(){try{P((s=>r(l({},s),{[t]:!0})));const a=yield m.checkPaymentStatus({subscription_id:t}),i=s.map((s=>s.id===t?l(l({},s),a):s));e(i),"Active"===a.status?alert("✅ Payment confirmed! Your subscription is now active."):"Failed"===a.payment_status?alert("❌ Payment failed. Please try again or contact support."):alert(`Status: ${a.status} | Payment: ${a.payment_status}`)}catch(a){alert("Failed to check payment status. Please try again.")}finally{P((s=>r(l({},s),{[t]:!1})))}}));var t},disabled:g[a.id],children:g[a.id]?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"spinner-small"}),o.jsx("span",{children:"Checking..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(h,{}),o.jsx("span",{children:"Check Status"})]})}),"Failed"===a.payment_status&&o.jsxs("button",{className:"action-btn retry-payment",onClick:()=>{return s=a.id,d(void 0,null,(function*(){try{const e=yield m.retryPayment({subscription_id:s});e.redirect_url&&(window.location.href=e.redirect_url)}catch(e){alert("Failed to retry payment. Please try again.")}}));var s},children:[o.jsx(h,{}),o.jsx("span",{children:"Retry Payment"})]})]})]},a.id)}))}),o.jsx("div",{className:"history-link-section",children:o.jsx("button",{className:"history-link-btn",onClick:()=>O("/subscription/history"),children:"View Detailed History →"})})]})};export{f as default};
